.. _interface:

开放接口
========

::

    https://api.sonma.net

.. _print:

打印
--------

接口地址
^^^^^^^^

.. http:post:: /v1/print

请求参数
^^^^^^^^

============ =============== ====================================================================================================
参数名称       是否必须          说明
============ =============== ====================================================================================================
content      是               打印内容,可以是模板格式加数据的形式(xml),纯数据(单张打印{},多张打印[]或者指定次数[{content={},times=x}])的形式
token        否               使用对称签名时无需传此项,签名优先级高于Token
sn           否               打印机唯一编号
template     否               模板编号,未传模板编号时,content默认会按模板加数据(xml)的形式做解析
============ =============== ====================================================================================================

.. note::

    可以使用 :ref:`对称签名 <sign>` 和 :ref:`Token <token>` 两种鉴权方式,根据不同的应用场景进行选择 :ref:`这里有说明 <important>`





返回示例
^^^^^^^^

.. code-block:: json

    {
      "code": 0,
      "message": "success"
    }

.. _token:

获取Token
------------

获取指定打印机的 Token (鉴权令牌)

接口地址
^^^^^^^^

.. http:get:: /v1/auth/access_token


请求参数
^^^^^^^^

============ =============== ====================================================================
参数名称       是否必须          说明
============ =============== ====================================================================
scope        是               权限范围: * 表示账户下所有打印机 , 1000xxxxxx 表示指定打印机,[x,x]表示打印机组
exp          否               过期时间,10位Unix时间戳
============ =============== ====================================================================

返回示例
^^^^^^^^

烧写图片
------------

接口地址
^^^^^^^^

.. http:post:: /v1/print/image

Content-Type: multipart/form-data

请求参数
^^^^^^^^

============ =============== ====================================================================
参数名称       是否必须          说明
============ =============== ====================================================================
token        否               鉴权方式自选
sn           是               打印机串号
file         是               图片文件
width        否               指定图片宽度(单位像素,最大800)
height       否               指定图片高度(单位像素,不限)
threshold    否               图片黑白处理阀值(0~255),数值越大图片越黑
============ =============== ====================================================================







返回示例
^^^^^^^^


.. code-block:: json

    {
        "code": 0,
        "message": "WangWang20170527101234.BMP"
    }


图片测试模板

.. code-block:: xml

    <?xml version="1.0" encoding="UTF-8"?>
    <page width="100" height="100" >
        <image x="0" y="0" width="100" height="100" src="filename:<%=logo>"/>
    </page>

.. note::

    烧写后图片名称为 <原图片名>.BMP



获取打印机状态(在线)
-------------------------

接口地址
^^^^^^^^

.. http:get:: /printer/{sn}/status



请求参数
^^^^^^^^

============ =============== ====================================================================
参数名称       是否必须          说明
============ =============== ====================================================================
token        否               鉴权方式自选
============ =============== ====================================================================

返回示例
^^^^^^^^


.. code-block:: json

    {
        "code": 0,
        "online": true
    }

获取打印机状态(详细)
---------------------

接口地址
^^^^^^^^

.. http:get:: /printer/{sn}


请求参数
^^^^^^^^

============ =============== ====================================================================
参数名称       是否必须          说明
============ =============== ====================================================================
token        否               鉴权方式自选
============ =============== ====================================================================

返回示例
^^^^^^^^


.. code-block:: json

    {
        "sn": 1002123456,
        "name": "测试打印机",
        "type": "TSCDA200",
        "online": false,
        "status": 0,
        "queue": 0
    }

返回值说明
-----------

=========== ================================================
返回码       说明
=========== ================================================
type        打印机类型
online      是否在线
status      实时状态
queue       打印队列长度
=========== ================================================


.. _returncode:

返回码说明
-----------

=========== ================================================
返回码       说明
=========== ================================================
0           调用成功
=========== ================================================