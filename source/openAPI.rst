开放接口
-------------

.. _token:

获取Token
^^^^^^^^^^^

获取Token (鉴权令牌)

接口地址
~~~~~~~~~

.. http:get:: /v1/auth/access_token


请求参数
~~~~~~~~~

============ =============== ========================================================================
参数名称       是否必须          说明
============ =============== ========================================================================
scope        是               权限范围: * 表示账户下所有打印机 , 1000xxxxxx 表示指定打印机,[x,x,...]表示打印机组
exp          否               过期时间,10位Unix时间戳,最长时间为1年
============ =============== ========================================================================

返回示例
~~~~~~~~~

.. code-block:: json

    {
      "code": 0,
      "token": "eyJhbGciOiJIUzI1NiJ9.eyJ1aWQiOiIzNDAwNjkiLCJzY29wZSI6WyIqIl0sImlzcyI6ImFwaS5zb25tYS5uZXQiLCJleHAiOjE0OTc1MTkzNDJ9.PwlIwY9IzqYEM4NTnKofLz9TbmEfHmxbjmrOnOA9ciA"
    }
.. code-block:: json

    {
      "code":40030,
      "message":"过期时间不能早于Thu Jun 15 07:37:45 UTC 2017"
    }


.. _delete_token:

吊销token
^^^^^^^^^^^

接口地址
~~~~~~~~~

.. http:delete:: /auth/access_token/{token}

============ =============== ========================================================================
参数名称       是否必须          说明
============ =============== ========================================================================
token              是               鉴权方式自选
============ =============== ========================================================================

返回示例
~~~~~~~~~

.. code-block:: json

    {
        "code": 0,
        "message": "success"
    }

烧写图片
^^^^^^^^^^^^^

接口地址
~~~~~~~~~~~~

.. http:post:: /v1/print/image

.. important::

    Content-Type: multipart/form-data

请求参数
~~~~~~~~~~~

============ =============== ====================================================================
参数名称       是否必须          说明
============ =============== ====================================================================
token        否               鉴权方式自选
sn           是               打印机串号
file         是               图片文件
name         否               图片名称(无需后缀)
width        否               指定图片宽度(单位像素,最大800)
height       否               指定图片高度(单位像素,不限)
threshold    否               图片黑白处理阀值(0~255),数值越大图片越黑
============ =============== ====================================================================

返回示例
~~~~~~~~~~


.. code-block:: json

    {
        "code": 0,
        "message": "WangWang20170527101234.BMP"
    }


图片测试模板

.. code-block:: xml

    <?xml version="1.0" encoding="UTF-8"?>
    <page width="100" height="100" >
        <image x="0" y="0" width="100" height="100" src="filename:<%=logo>"/>
    </page>

.. note::

    烧写后图片名称为 <原图片名>.BMP

.. _transport_file:

上传图片
^^^^^^^^^^

接口地址
~~~~~~~

.. http:post:: /v1/print/file

请求参数
~~~~~~~~~

============ =============== ========================================================================
参数名称       是否必须          说明
============ =============== ========================================================================
file              是               指定上传的图片
remark            是               图片名称
sn                是               打印机唯一编号
============ =============== ========================================================================

返回示例
~~~~~~~

.. code-block:: json

    {
        "code": 0,
        "message": "success"
    }

.. _preview:

预览图片
^^^^^^^^

接口地址
~~~~~~~

.. http:post:: /v1/print/preview

请求参数
~~~~~~~~~

============ =============== ========================================================================
参数名称       是否必须          说明
============ =============== ========================================================================
content           是               解析的图片资源
template          否               打印模板
type              否               打印方式
============ =============== ========================================================================

获取打印机状态(在线)
^^^^^^^^^^^^^

接口地址
~~~~~~~~~

.. http:get:: /printer/{sn}/status



请求参数
~~~~~~~~~~

============ =============== ====================================================================
参数名称       是否必须          说明
============ =============== ====================================================================
token        否               鉴权方式自选
============ =============== ====================================================================

返回示例
~~~~~~~~~


.. code-block:: json

    {
        "code": 0,
        "online": true
    }

获取打印机状态(详细)
^^^^^^^^^^^^^^^

接口地址
~~~~~~~~~~~

.. http:get:: /printer/{sn}


请求参数
~~~~~~~~~~~

============ =============== ====================================================================
参数名称       是否必须          说明
============ =============== ====================================================================
token        否               鉴权方式自选
============ =============== ====================================================================

返回示例
~~~~~~~~~~~


.. code-block:: json

    {
        "sn": 1002123456,
        "name": "测试打印机",
        "type": "TSCDA200",
        "online": false,
        "status": 0,
        "queue": 0
    }

.. _print:

打印
^^^^^^^^^^^

接口地址
~~~~~~~~

.. http:post:: /v1/print

请求参数
~~~~~~~~~~

============ =============== ====================================================================================================
参数名称       是否必须          说明
============ =============== ====================================================================================================
content      是               打印内容,可以是模板格式加数据的形式(xml),
                              纯数据(单张打印{},多张打印[]
                              或者指定次数[{content={},times=x}])的形式
token        否               使用请求头鉴权时无需传此项,签名优先级高于Token
sn           否               打印机唯一编号
template     否               模板编号,未传模板编号时,content默认会按模板加数据(xml)的形式做解析
============ =============== ====================================================================================================

.. note::

    可以使用 :ref:`对称签名 <sign>` 和 :ref:`Token <token>` 两种鉴权方式,根据不同的应用场景进行选择 :ref:`这里有说明 <important>`


返回示例
~~~~~~~~

.. code-block:: json

    {
      "code": 0,
      "message": "success"
    }

.. code-block:: json

    {
        "code": 202,
        "message": "PendingException: 打印机离线,已加入打印队列"
    }

.. _queue_clear:

清空打印队列
^^^^^^^^^^^^^

接口地址
~~~~~~~~~~

.. http:delete:: /printer/{sn}/queue

请求参数
~~~~~~~~~~~

============ =============== ====================================================================================================
参数名称       是否必须          说明
============ =============== ====================================================================================================
sn           否               打印机唯一编号
============ =============== ====================================================================================================

返回示例
~~~~~~~~~~

.. code-block:: json

    {
      "code": 0,
      "message": "success"
    }

返回值说明
^^^^^^^^^^^^^

=========== ================================================
返回码       说明
=========== ================================================
type        打印机类型
online      是否在线
status      实时状态
queue       打印队列长度
=========== ================================================